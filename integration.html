
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>Baruwa:: A web 2.0 MailScanner frontend | MTA Integration</title>
	<link rel="icon" href="_static/favicon.ico" type="image/x-icon" />
	<link rel="shortcut icon" href="_static/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" href="_static/reset.css" type="text/css" media="screen" title="no title" charset="utf-8" />
	<link rel="stylesheet" href="_static/text.css" type="text/css" media="screen" title="no title" charset="utf-8" />
	<link rel="stylesheet" href="_static/960.css" type="text/css" media="screen" title="no title" charset="utf-8" />
	<!--<link rel="stylesheet" href="_static/pygments.css" type="text/css" media="screen" title="no title" charset="utf-8" />-->
	<link rel="stylesheet" href="_static/baruwa.css" type="text/css" media="screen" title="no title" charset="utf-8" />
	<script src="_static/jquery.js" type="text/javascript"></script>
	<script src="_static/hosted.js" type="text/javascript"></script>
	<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-261565-4']);
	_gaq.push(['_trackPageview']);
	</script>
</head>
<body>
	<div id="wrap" class="container_16">
		<div id="header" class="grid_16">
			<div id="log" class="grid_8"><img src="_static/logo.png" alt="Baruwa" /></div>
		</div>
		<div id="navigation" class="grid_16"><ul>
	<li><a href="http://www.baruwa.org/">Home</a></li>
	<li><a href="http://www.baruwa.org/about/">About</a>
	<ul>
		<li><a href="http://www.baruwa.org/about/features.html">Features</a></li>
		<li><a href="http://www.baruwa.org/about/screenshots.html">Screenshots</a></li>
		<li><a href="http://www.baruwa.org/about/requirements.html">Requirements</a></li>
	</ul>
	</li>
	<li><a href="http://www.baruwa.org/blog/">Blog</a></li>
	<li><a href="http://www.baruwa.org/documentation/">Documentation</a>
		<ul>
			<li><a href="http://www.baruwa.org/documentation/">Read online</a></li>
			<li><a href="http://www.baruwa.org/documentation/#downloads">Download</a></li>
			<li><a href="https://github.com/akissa/baruwa/wiki">Wiki</a></li>
			<li><a href="http://www.baruwa.org/documentation/#mirrors">Mirrors</a></li>
		</ul>
	</li>
	<li><a href="http://www.baruwa.org/community/">Community</a></li>
	<li><a href="http://www.baruwa.org/download/">Download</a></li>
	<li><a href="http://www.baruwa.org/development/">Development</a></li>
	<li><a href="http://www.baruwa.org/support/">Support</a>
		<ul>
			<li><a href="http://www.baruwa.org/support/">Free support</a></li>
			<li><a href="http://www.baruwa.org/support/">Commercial support</a></li>
		</ul>
	</li>
</ul>
		</div>
		<div class="clear">&nbsp;</div>
		<div id="main" class="grid_16 featured">
			<div class="grid_15"><h1>Baruwa Documentation: 1.1.1</h1></div>
		</div>
		<div id="holder" class="grid_16">
			<div id="sidebar" class="grid_3">
<h3>Site Search</h3>
<form action="http://www.google.com/cse" id="cse-search-box">
<div>
   	<input type="hidden" name="cx" value="partner-pub-3001556624430247:g7zpfj4e9qx" />
    <input type="hidden" name="ie" value="ISO-8859-1" />
    <input type="text" name="q" size="15" /><input type="submit" name="sa" value="Go" />
</div>
</form>

  <h3><a href="index.html">Docs Home</a></h3>
  <ul>
<li><a class="reference internal" href="#">MTA Integration</a><ul>
<li><a class="reference internal" href="#postfix">Postfix</a><ul>
<li><a class="reference internal" href="#relay-domains">Relay domains</a></li>
<li><a class="reference internal" href="#transports">Transports</a></li>
<li><a class="reference internal" href="#relay-recipient-maps">Relay recipient maps</a></li>
<li><a class="reference internal" href="#global-whitelist">Global Whitelist</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exim">Exim</a><ul>
<li><a class="reference internal" href="#route-data">Route Data</a></li>
<li><a class="reference internal" href="#id1">Relay domains</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="authentication.html"
                        title="previous chapter">External authentication</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="distributed_setup.html"
                        title="next chapter">Clustered setups</a></p><h3>Download docs</h3>
<ul>
	<li><a href="http://topdog-software.com/oss/baruwa/1.1.1/docs/baruwa.pdf">PDF</a></li>
	<li><a href="http://topdog-software.com/oss/baruwa/1.1.1/docs/baruwa.epub">EPUB</a></li>
</ul><h3>Support Baruwa</h3>
<p>
	Your generous donations help fund future development.
</p>
<p>
<a href='http://www.pledgie.com/campaigns/12056'>
	<img alt='make a donation at www.pledgie.com !' src="_static/paypal-donate.png" border='0' />
	<img alt='make a donation at www.pledgie.com !' src="_static/visa.png" border='0' />
	<img alt='make a donation at www.pledgie.com !' src="_static/mastercard.png" border='0' />
</a>
</p>
<h3>Ads</h3>
<div>
	<script type="text/javascript"><!--
	google_ad_client = "pub-3001556624430247";
	/* Docs */
	google_ad_slot = "9418887640";
	google_ad_width = 120;
	google_ad_height = 240;
	//-->
	</script>
	<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</div>
<div>&nbsp;</div>
			</div>
			<div id="content" class="grid_12">
				
  <div class="section" id="mta-integration">
<span id="integration"></span><h1>MTA Integration</h1>
<p>Baruwa can be integrated with the MTA to enable configuring of some
MTA features from with in Baruwa. Postfix and Exim are the only MTA&#8217;s
supported at the moment as Sendmail lacks native SQL support.</p>
<div class="section" id="postfix">
<h2>Postfix</h2>
<p>At the moment the following features can be integrated</p>
<ul class="simple">
<li>Relay domains</li>
<li>Transports</li>
<li>Relay recipient maps</li>
<li>Global whitelists</li>
</ul>
<div class="section" id="relay-domains">
<h3>Relay domains</h3>
<p>In your postfix main.cf file set:</p>
<div class="highlight-python"><pre>relay_domains = mysql:/etc/postfix/mysql-relay_domains.cf</pre>
</div>
<p>Then create the /etc/postfix/mysql-relay_domains.cf file with the following
content:</p>
<div class="highlight-python"><pre>user = baruwa
password = password
dbname = baruwa
query = SELECT address FROM user_addresses WHERE \
 address='%s' AND enabled=1 AND address_type=1;
hosts = 127.0.0.1</pre>
</div>
</div>
<div class="section" id="transports">
<h3>Transports</h3>
<p>In your postfix main.cf file set:</p>
<div class="highlight-python"><pre>transport_maps = mysql:/etc/postfix/mysql-transports.cf</pre>
</div>
<p>Then create the /etc/postfix/mysql-transports.cf file with the following
content:</p>
<div class="highlight-python"><pre>user = baruwa
password = password
dbname = baruwa
query = SELECT CONCAT('smtp:[', mail_hosts.address, ']:', port) \
FROM mail_hosts, user_addresses WHERE user_addresses.address = '%s' AND \
user_addresses.id = mail_hosts.useraddress_id;
hosts = 127.0.0.1</pre>
</div>
</div>
<div class="section" id="relay-recipient-maps">
<h3>Relay recipient maps</h3>
<p>In your postfix main.cf file set:</p>
<div class="highlight-python"><pre>relay_recipient_maps = mysql:/etc/postfix/mysql-relay_recipients.cf</pre>
</div>
<p>Then create the /etc/postfix/mysql-relay_recipients.cf file with the
following content:</p>
<div class="highlight-python"><pre>user = baruwa
password = password
dbname = baruwa
query = SELECT 1 FROM user_addresses WHERE address='%s' AND address_type=2 \
UNION SELECT 1 FROM auth_user WHERE username = '%s' OR email = '%s' \
hosts = 127.0.0.1</pre>
</div>
</div>
<div class="section" id="global-whitelist">
<h3>Global Whitelist</h3>
<p>In your postfix main.cf file set:</p>
<div class="highlight-python"><pre>whitelist_policy = check_client_access mysql:/etc/postfix/mysql-global_lists.cf
smtpd_recipient_restrictions = whitelist_policy</pre>
</div>
<p>Then create the /etc/postfix/mysql-global_lists.cf with the following
content:</p>
<div class="highlight-python"><pre>user = baruwa
password = password
dbname = baruwa
query = SELECT CONCAT('PERMIT') FROM lists WHERE from_address='%s' AND list_type=1 \
UNION SELECT CONCAT('REJECT') FROM lists WHERE from_address='%s' AND list_type=2;
hosts = 127.0.0.1</pre>
</div>
</div>
</div>
<div class="section" id="exim">
<h2>Exim</h2>
<p>At the moment the following features can be integrated.</p>
<ul class="simple">
<li>Route Data</li>
<li>Relay domains</li>
</ul>
<div class="section" id="route-data">
<h3>Route Data</h3>
<p>You can use the following route_data option in your routers used to deliver the cleaned
mail:</p>
<div class="highlight-python"><pre>route_data = ${lookup mysql {SELECT GROUP_CONCAT(CONCAT(mail_hosts.address,\
                '::',mail_hosts.port) SEPARATOR ':') a FROM mail_hosts, \
                user_addresses WHERE useraddress_id=user_addresses.id AND \
                user_addresses.address = '${quote_mysql:$domain}' AND \
                mail_hosts.enabled = 1 AND user_addresses.enabled = 1}}</pre>
</div>
</div>
<div class="section" id="id1">
<h3>Relay domains</h3>
<p>Use the following domain list in your acl&#8217;s:</p>
<div class="highlight-python"><pre>domainlist relay_sql_domains = mysql;SELECT address FROM user_addresses WHERE \
address_type=1 AND enabled=1 AND address='${quote_mysql:$domain}';</pre>
</div>
</div>
</div>
</div>


			</div>
		</div>
		<div id="footer" class="grid_16"><div id="sitemap" class="grid_16">
    <div id="sitelinks" class="grid_3">
        <h4>About</h4>
        <ul>
            <li><a href="http://www.baruwa.org/about/">Introduction</a></li>
            <li><a href="http://www.baruwa.org/about/features.html">Features</a></li>
            <li><a href="http://www.baruwa.org/about/screenshots.html">Screenshots</a></li>
            <li><a href="http://www.baruwa.org/about/requirements.html">Requirements</a></li>
            <li><a href="http://www.baruwa.org/download/">Downloads</a></li>
			<li><a href="http://www.pledgie.com/campaigns/12056">Donations</a></li>
        </ul>
    </div>
    <div id="supportlinks" class="grid_4">
        <h4>Support</h4>
        <ul>
            <li><a href="http://www.baruwa.org/community/#mlist">Mailing list</a></li>
            <li><a href="http://www.baruwa.org/community/#irc">IRC</a></li>
            <li><a href="https://github.com/akissa/baruwa/issues">Issue tracker</a></li>
            <li><a href="http://www.baruwa.org/support/">Commercial support</a></li>
        </ul>
    </div>
    <div id="doclins" class="grid_4">
        <h4>Documentation</h4>
        <ul>
            <li><a href="http://www.baruwa.org/documentation/">Read online</a></li>
            <li><a href="http://www.baruwa.org/documentation/#downloads">Download</a></li>
            <li><a href="http://www.baruwa.org/community/#wiki">Wiki</a></li>
            <li><a href="http://www.baruwa.org/documentation/#mirrors">Mirrors</a></li>
            <li><a href="http://www.baruwa.org/blog/">Blog</a></li>
        </ul>
    </div>
    <div id="search" class="grid_4">
		<h4>Documentation Quick links</h4>
		<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#features">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#screenshots">Screenshots</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Source Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_centos.html">Baruwa on RHEL/SL/Centos</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_fedora.html">Baruwa on Fedora</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_debian.html">Baruwa on Ubuntu/Debian</a></li>
<li class="toctree-l1"><a class="reference internal" href="authentication.html">External authentication</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">MTA Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed_setup.html">Clustered setups</a></li>
<li class="toctree-l1"><a class="reference internal" href="batteries_included.html">Other batteries included</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Getting Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contributing to Baruwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrade.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Migrate from Mailwatch</a></li>
<li class="toctree-l1"><a class="reference internal" href="userguide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="old.html">Older documentation</a></li>
</ul>

    </div>
</div>
<div class="clear">&nbsp;</div>
<div class="grid_16" id="copylinks">
<div id="copy-left" class="grid_8">
    <span>Follow Baruwa...</span>
    <a href="http://www.baruwa.org/blog/feed/index.xml"><img src="_static/feed.png" alt="RSS feeds"  title="Baruwa RSS feeds" /></a>
    <a href="http://identi.ca/baruwa"><img src="_static/identi.png" alt="Identi"  title="Baruwa on Identi" /></a>
    <a href="http://twitter.com/baruwaproject"><img src="_static/twitter.png" alt="twitter"  title="Baruwa on Twitter" /></a>
    <a href="http://www.facebook.com/share.php?u=http://www.baruwa.org/integration.html&amp;t=Baruwa"><img src="_static/facebook.png" alt="facebool"  title="Baruwa on Facebook" /></a>
    <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://www.baruwa.org/integration.html"><img src="_static/linkedin.png" alt="linkedin"  title="Baruwa on Linkedin" /></a>
    <a href="http://www.flickr.com/photos/baruwa"><img src="_static/flickr.png" alt="flickr"  title="Baruwa on Flickr" /></a>
    <a href="http://delicious.com/save?v=5&amp;url=http://www.baruwa.org/integration.html&amp;title=Baruwa"><img src="_static/delicious.png" alt="delicious"  title="Baruwa on delicious" /></a>
    <a href="http://www.stumbleupon.com/submit?url=http://www.baruwa.org/integration.html"><img src="_static/stumble.png" alt="stumbleupon" title="Baruwa on stumbleupon" /></a>
    <a href="http://reddit.com/submit?url=http://www.baruwa.org/integration.html"><img src="_static/reddit.png" alt="reddit" title="Add to reddit" /></a>
    <a href="http://github.com/akissa/baruwa"><img src="_static/github.png" alt="Github" title="Baruwa on Github" /></a>
    <a href="http://freshmeat.net/projects/baruwa"><img src="_static/fm.png" alt="Freshmeat" title="Baruwa on Freshmeat" /></a>
    <a href="http://www.pledgie.com/campaigns/12056"><img src="_static/paypal.png" alt="Donate"  title="Donate to Baruwa" /></a>
</div>
<div id="copy-right" class="grid_7">&copy; Copyright 2010, Andrew Colin Kissa.
</div>
</div>
		</div>
	</div>
	<script type="text/javascript">
	(function() {
	var ga = document.createElement('script');
	ga.src = ('https:' == document.location.protocol ?
	'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	ga.setAttribute('async', 'true');
	document.documentElement.firstChild.appendChild(ga);
	})();
	</script>
	<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
</body>
</html>